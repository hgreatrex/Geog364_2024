<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lab 4: Neighbourhood</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">GEOG-364</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="pg_Tut1_about.html">1. About R, R-Studio &amp; R-Studio Cloud</a>
    </li>
    <li>
      <a href="pg_Tut2_startup.html">2. Getting started</a>
    </li>
    <li>
      <a href="pg_Tut3_basics.html">3. Console Basics</a>
    </li>
    <li>
      <a href="pg_Tut4_markdown.html">4. Markdown</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="pg_364Lab1_Basics_2021.html">Lab 1: R-Basics</a>
    </li>
    <li>
      <a href="pg_364Lab2_Summary.html">Lab 2: Summarising data</a>
    </li>
    <li>
      <a href="pg_364Lab3_Spatial.html">Lab 3: Spatial Basics</a>
    </li>
    <li>
      <a href="pg_364Lab4_Neighbourhood.html">Lab 4: Neighbourhood</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lab 4: Neighbourhood</h1>
<h3 class="subtitle"><h4 style="font-style:normal"><br />
GEOG-364 - Spatial Analysis<br />
</h4></h3>

</div>


<p><br></p>
<div id="welcome-to-lab-4" class="section level2">
<h2>Welcome to Lab 4!</h2>
<div id="aims" class="section level3">
<h3>Aims</h3>
<ul>
<li><p>Today’s lab explores the concepts of <strong>Domain
(environment)</strong>, <strong>Location</strong>,
<strong>Distance</strong> and <strong>Neighborhood</strong> and tests
useful tools.</p></li>
<li><p>Next week (4B), we pull these tools together to study
<strong>Connection</strong>, specifically
<strong>autocorrelation</strong>.</p></li>
<li><p>In addition, you will learn skills such as downloading data from
OpenStreetMap and how to use the “sfdep” package.</p></li>
</ul>
<p><br></p>
<p class="comment"><strong>THIS IS A TWO WEEK LAB. <br>You have two full lab sessions, then, assignment 4 is due the week afterwards.<br>The lab is worth 110 points and there is a rubric at the end of this page.</strong></p>
<p><br><br></p>
</div>
</div>
<div id="week-1" class="section level2">
<h2>WEEK 1</h2>
<div id="a-set-up---dont-skip" class="section level3">
<h3>A: Set up - DON’T SKIP</h3>
<div id="step-a1.-files-projects" class="section level4">
<h4>Step A1. Files &amp; Projects</h4>
<details>
<summary>
POSIT CLOUD people, expand for set up
</summary>
<p><br></p>
<p><strong>Step i:</strong><br>Go to <a
href="https://posit.cloud/content/"
class="uri">https://posit.cloud/content/</a> and make a new project for
Lab 3 <br><br></p>
<p><strong>Step ii:</strong><br>Run this code IN THE CONSOLE to install
the packages you need. <br></p>
<ul>
<li>This is going to take 5-10 minutes, so let it run and carry on.
<br><br></li>
</ul>
<pre class="r"><code>install.packages(&quot;readxl&quot;)
install.packages(&quot;tidyverse&quot;)
install.packages(&quot;ggplot2&quot;)
install.packages(&quot;dplyr&quot;)
install.packages(&quot;remotes&quot;)

remotes::install_github(repo = &quot;r-spatial/sf&quot;, 
                        ref = &quot;93a25fd8e2f5c6af7c080f92141cb2b765a04a84&quot;)
install.packages(&quot;terra&quot;)
install.packages(&quot;tmap&quot;)
install.packages(&quot;elevatr&quot;)
install.packages(&quot;nasapower&quot;)
install.packages(&quot;osmdata&quot;)
install.packages(&quot;tigris&quot;)
install.packages(&quot;rmdformats&quot;)
install.packages(&quot;plotly&quot;)
install.packages(&quot;ggstatsplot&quot;)
install.packages(&quot;spdep&quot;)
install.packages(&quot;osmdata&quot;)
install.packages(&quot;units&quot;)


# If you get a weird error it might be that the quote marks have messed up. 
# Replace all of them and ask Dr G for a shortcut.</code></pre>
<p><br><br></p>
<p><strong>Step iii:</strong> <br>Go to the Lab Canvas page and download
these 4 files. Upload each one into your project
folder.<br><em>Forgotten how? See Lab 2 Set-Up.</em> <br></p>
<ol style="list-style-type: decimal">
<li>TWO “mystery datasets”. <br></li>
<li>The lab report template .RmD file.<br></li>
</ol>
<p><br></p>
</details>
<div class="small-gap">

</div>
<details>
<summary>
R-DESKTOP people, expand for set up
</summary>
<p><br></p>
<p><strong>Step i:</strong><br>Create a new project for Lab
4.<br><em>Forgotten how? See Lab 2 Set-Up.</em><br><br></p>
<p><strong>Step ii:</strong><br>Go to the Lab Canvas page and download
these files. Put them in your project folder for Lab 4<br></p>
<ol style="list-style-type: decimal">
<li>TWO “mystery datasets”. <br></li>
<li>The lab report template .RmD file.<br></li>
</ol>
<p><strong>Step iii:</strong><br>Open the Lab report template and try to
run the library code chunk file. Install any packages you are missing
(either via clicking the little yellow bar or by clicking
Packages/Install) <br><br></p>
</details>
<p><br></p>
</div>
<div id="step-a2.-change-the-theme" class="section level4">
<h4>Step A2. Change the theme</h4>
<details>
<summary>
Instructions
</summary>
<p><br></p>
<p>This is more for us when we’re grading! It helps us to not go insane
when we’re reading 60 reports.<br><br></p>
<p><strong>Step i:</strong> Change the AUTHOR line to your personal
E-mail ID <br><br></p>
<p><strong>Step ii:</strong> Go here and choose a theme out of downcute,
robobook, material, readthedown or html_clean: <a
href="https://github.com/juba/rmdformats?tab=readme-ov-file#formats-gallery"
class="uri">https://github.com/juba/rmdformats?tab=readme-ov-file#formats-gallery</a>.<br>
<em>DO NOT CHOOSE html_docco - it doesn’t have a table of contents</em>
<br><br></p>
<p><strong>Step iii:</strong><br>Change the theme line on the template
YAML code to a theme of your choice. See the example YAML code below
<br> <em>Note, downcute chaos is different - see below</em><br><br></p>
<ol style="list-style-type: decimal">
<li>Example YAML code if you want <code>robobook</code>,
<code>material</code>, <code>readthedown</code> or
<code>html_clean</code>. You can also change the highlight option to
change how code chunks look. - see the rmdformats website.</li>
</ol>
<pre class="r"><code>---
title: &quot;Lab 4&quot;
author: &quot;ADD YOUR EMAIL ID&quot;
date: &quot;`r Sys.Date()`&quot;
output:
  rmdformats::robobook:
    self_contained: true
    highlight: kate
---</code></pre>
<p><br></p>
<ol start="2" style="list-style-type: decimal">
<li>Example YAML code if you want <code>downcute</code> or
<code>downcute chaos</code>. For white standard downcute, remove the
downcute_theme line.</li>
</ol>
<pre class="r"><code>---
title: &quot;Lab 4&quot;
author: &quot;ADD YOUR EMAIL ID&quot;
date: &quot;`r Sys.Date()`&quot;
output:
  rmdformats::downcute:
    self_contained: true
    downcute_theme: &quot;chaos&quot;
    default_style: &quot;dark&quot;
---</code></pre>
<p><br><br></p>
</details>
<p><br><br></p>
</div>
</div>
<div id="b-core-spatial-attributes" class="section level3">
<h3>B: Core spatial attributes</h3>
<p>In spatial statistics, <strong>Domain (environment)</strong>,
<strong>Location</strong>, <strong>Distance</strong>,
<strong>Neighborhood</strong>, and <strong>Connection</strong> form the
foundation of understanding spatial relationships and patterns in
data.</p>
<p>Expand to read the collected summaries of why each is important. They
are short and it will put the lab into context of the lectures/exams.
There is nothing to write/submit here, but it will save you time
later.</p>
<details>
<summary>
<strong>READ THESE SUMMARIES</strong>
</summary>
<p><br></p>
<p class="comment"><strong>DOMAIN:</strong><br> In traditional statistics, we assume that our sample is randomly selected, independent and completely representative of the underlying population. Spatial data however, is tied to physical space and all its complexity. The spatial domain describes both the environment or area within which your data exists and defines the spatial boundaries of your analysis.</p>
<div class="small-gap">

</div>
<p class="comment"><strong>LOCATION:</strong><br> Every spatial analysis starts with the location of an object or event. By knowing where something happens, we can begin to ask spatial questions—such as, "What is near it?" or "How do other events relate to this one?".</p>
<div class="small-gap">

</div>
<p class="comment"><strong>DISTANCE:</strong><br> The distance between locations tells us how spatially separated objects are, which helps us understand potential interactions. For instance, nearby points may share common factors, while distant points may behave independently. Spatial analysis often explores whether proximity leads to similarity or differences.</p>
<div class="small-gap">

</div>
<p class="comment"><strong>NEIGHBOURHOOD:</strong><br> A neighborhood defines the spatial context around a location. By determining what qualifies as a 'neighbor' (whether based on distance or shared boundaries), we can study patterns of clustering or dispersion, and how events influence each other across space.</p>
<div class="small-gap">

</div>
<p class="comment"><strong>CONNECTION:</strong><br> Connection examines the relationships between locations, such as movement or interactions (e.g., trade routes, traffic, or social interactions). Understanding these connections helps in analyzing spatial networks and interaction patterns, such as how diseases spread or how resources are accessed.<br><br> For example, in lab 4B, we explore Spatial Autocorrelation refers to the idea that objects close to each other in space may be more similar (positive autocorrelation) or more different (negative autocorrelation) than those farther apart. This relies heavily on the concepts of neighborhood and distance, as these define which locations are considered "close" enough to be related and influence one another.</p>
<p><br><br></p>
</details>
<p><br><br></p>
</div>
<div id="c-domain" class="section level3">
<h3>C: Domain</h3>
<p>The spatial domain describes both the environment or area within
which your data exists and defines the spatial boundaries of your
analysis. If this domain is misrepresented—either by including
irrelevant areas or excluding critical regions—it can distort the
results and lead to incorrect inferences about spatial patterns.</p>
<p>There is no perfect domain for two reasons:</p>
<details>
<summary>
<strong>1. It depends on your needs</strong>
</summary>
<p><br></p>
<p>In part your choice of domain is going to depend on WHY you are
looking at the data. As we have seen in class, patterns such as
clustering are scale dependent - and so are the processes that cause
them. So you might choose a certain domain depending on your needs.</p>
<p>For example, consider the figure below, where I have plotted the same
data at two different scales:</p>
<ul>
<li><p>For example, a CDC representative for Pennsylvania might be
interested in considering the entire area as their ‘domain’ if they want
to understand the progression of a disease outbreak. At the moment it’s
clearly clustered in State College - useful information that can lead
directly to action.</p></li>
<li><p>They might ALSO be interested in analyzing the data across a
smaller domain to see if they can identify locations where the disease
is being spread (say one hall-of-residence). In this case, it’s clear we
don’t see a single easy cluster of cases. In fact they seem to be rather
uniformly spread out ( maybe that the locational fallacy is at
play?)</p></li>
</ul>
<p><img src="index_images/pg_Lab4_Domain1.png"
style="width:100.0%" /></p>
<p><br><br></p>
</details>
<div class="small-gap">

</div>
<details>
<summary>
<strong>Your data must have an equal chance of appearing anywhere in
your domain, or all your statistical tests won’t work</strong>
</summary>
<p><br></p>
<p>Your sample is must be representative of your population, so ALL THE
STATISTICS TESTS assume that there is an equal chance that any location
within your domain could contain data.</p>
<ul>
<li>If you make your domain too big, your data will appear to be is
clustered, but in fact you just didn’t collect data in part of the
domain.</li>
</ul>
<p>For example, if you were asked to assess if the dots in case A and B
below were arranged uniformly or were clustered together, you would have
very different outcomes, despite the dots themselves being
identical.</p>
<p><img src="index_images/pg_Lab4_Domain2.png"
style="width:100.0%" /></p>
<p><br><br></p>
</details>
<div class="small-gap">

</div>
<details>
<summary>
<strong>Its also CRUCIAL to consider the “non-uniformity of
space</strong>
</summary>
<p><br></p>
<p>As we discussed above, there should be an equal chance of seeing your
data anywhere in your domain. BUT.. Unlike traditional statistics, where
sampling is assumed to be random and uniform, spatial data is more
nuanced—landscape features, political borders, and human activity vary
greatly across space. Knowing these features can greatly change your
interpretation.</p>
<p>This effect is called the ‘non uniformity of space’ – when we know
more information about the background map than we can see in our actual
data.</p>
<p>For example:</p>
<ul>
<li><p>Is an area with low population density in a city linked to ‘a
lack of data collection’, ‘a lake/park’ or some sociopolitical reason?
Just looking at population density won’t tell you the answer, we also
need to look at the background map.</p></li>
<li><p>Equally, data might look clustered, but in fact there are just
areas where it’s not possible to have points. For example, without the
nuance of the background map you might get very different conclusions
from an analysis of bike parking in Helsinki:</p></li>
</ul>
<p><img src="index_images/pg_Lab4_Domain3NonUnif.png"
style="width:100.0%" /></p>
<p><br></p>
<p><strong>So consider the non uniformity of space when designing your
domain</strong></p>
<p>Your domain doesn’t have to be square! So we are balancing the need
for our domain to only contain landscapes that have an ‘equal chance’ of
seeing our data (e.g. we can’t get bike parking in the ocean’, vs the
complexity of making your domain so complex that you can’t get anything
done. This also links to the spatial fallacy of “fuzzy borders”</p>
<p><br><br></p>
</details>
<p><br></p>
<div id="exercise.-data-detective" class="section level4">
<h4>Exercise. Data detective</h4>
<p><br></p>
<p>I recently found two ‘mystery files’ on her desktop that I had
forgotten to name correctly.</p>
<p>I know they must be from two of these four experiments:</p>
<ol style="list-style-type: decimal">
<li><p>A cluster analysis of COVID cases in central PA</p></li>
<li><p>A cluster analysis of Mediterranean vineyards</p></li>
<li><p>A cluster analysis of Smooth-Hound Sharks</p></li>
<li><p>A cluster analysis of polar bears.</p></li>
</ol>
<p>To work out which experiments the data was from, I read them both
into R and made these maps… which didn’t help much!</p>
<p><img src="index_images/pg_Lab4_Domain4Mystery.png"
style="width:100.0%" /></p>
<p><br></p>
<div id="step-c1" class="section level5">
<h5>Step C1</h5>
<ul>
<li>If you haven’t already, GO AND DO THE SET-UP SECTION. You should now
have your project running, your libraries installed and your Lab 4
report open.</li>
</ul>
<p><br></p>
</div>
<div id="step-c3" class="section level5">
<h5>Step C3</h5>
<ul>
<li>In the appropriate place in your lab report, explain (in at least
100 words), how knowledge of the “the non-uniformity of space” can help
solve my problem above.</li>
</ul>
<p><br></p>
</div>
<div id="step-c3-1" class="section level5">
<h5>Step C3</h5>
<ul>
<li>Then, IN YOUR LAB REPORT, read each of the mystery datasets into R
using the `st_read()` command. <br> <em>Hint: If you can’t remember how
to do this, refer to your Lab 3 report where you read your state level
acs data into R..</em></li>
</ul>
<p><br></p>
</div>
<div id="step-c4" class="section level5">
<h5>Step C4</h5>
<ul>
<li><p>In your lab report, explore and map the data. Remember that there
are mapping tutorials in Lav 3 and Lab 2 - or here, <a
href="https://r-tmap.github.io/tmap-book/layers.html"
class="uri">https://r-tmap.github.io/tmap-book/layers.html</a><br />
</p></li>
<li><p>In your report, work out which experiment each dataset matches
(see the exercise intro). Explain your reasoning, providing common-sense
evidence linking to your explanation of the non uniformity of space <br>
<em>Hint this isn’t meant to be a trick, it should be pretty
simple.</em> <br> <em>Hint 2, If you’re stuck, remember interactive mode
tm_mode(“view”).</em></p></li>
</ul>
<p><br></p>
</div>
<div id="step-c5" class="section level5">
<h5>Step C5</h5>
<ul>
<li>In your lab report, for EACH of the two datasets and given my
experiment aims, describe what would be an appropriate spatial domain
and whether you consider the objects to be clustered or uniformly
distributed. Explain your reasoning.</li>
</ul>
<p>Note, no code is needed; your answer can be in words (50 words at
least per dataset).</p>
<p><br><br></p>
</div>
</div>
</div>
<div id="d-distance-closeness" class="section level3">
<h3>D: Distance &amp; closeness</h3>
<p>Now we are going to practice downloading data from Open Street Map
and to look at some of the different ways to assess distance and
location. Specifically we’re going to explore at the locations of fire
stations in Chicago.</p>
<p><br></p>
<div id="exercise.-getting-vector-data-from-open-street-map"
class="section level4">
<h4>Exercise. Getting vector data from Open Street map</h4>
<p>R connects easily with the website OpenStreetMap. This is becoming a
crucial resource in spatial statistics, although the data can be messy
(it’s being entered by volunteers).</p>
<div class="small-gap">

</div>
<div id="step-d1---learn-about-open-street-map" class="section level5">
<h5>Step D1 - Learn about Open Street Map</h5>
<details>
<summary>
<strong>Expand and complete!</strong>
</summary>
<p><br></p>
<ul>
<li><p>Watch the 2 minute video below about open street map and go and
explore it here <a href="https://www.openstreetmap.org/"
class="uri">https://www.openstreetmap.org/</a>. You can also read more
about its background and get help here: <a
href="https://wiki.openstreetmap.org/wiki/About_OpenStreetMap"
class="uri">https://wiki.openstreetmap.org/wiki/About_OpenStreetMap</a></p></li>
<li><p>In the appropriate spot in your report, write at least 100 words
describing Open Street Map and explaining why its useful.</p></li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Phwrgb16oEM?si=xwWWBkKSr4MpLAiA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
</iframe>
<br><br>
</details>
<div class="small-gap">

</div>
</div>
<div id="step-d2---get-the-data" class="section level5">
<h5>Step D2 - Get the data</h5>
<details>
<summary>
<strong>Expand and complete!</strong>
</summary>
<p><br></p>
<ul>
<li>This code will load the locations of all the Fire-Stations in
Chicago into R. Copy carefully into your report and run.</li>
</ul>
<pre class="r"><code># Get a RECTANGULAR bounding box for Chicago
bbox_city_rectangle &lt;- getbb(&quot;Chicago, USA&quot;) 

# Now query OpenStreetMap 
fire_stationdata &lt;- opq(bbox = bbox_city_rectangle) %&gt;%
     add_osm_feature(key = &quot;amenity&quot;, value = &quot;fire_station&quot;) %&gt;%
     osmdata_sf()

# Look at the data
fire_stationdata</code></pre>
<p><br></p>
<ul>
<li><p>You should see a list of the data you have just downloaded. This
command returns EVERYTHING related to fire stations in the area and you
can see that there is space for every type of vector data, in our case
1586 points and 165 polygons. From a quick glance, I think the polygons
refer to fire station buildings and the points are ANYTHING fire-service
related.</p></li>
<li><p>Click here to understand what you just did: <a
href="https://www.youtube.com/watch?v=kcpiH6dDWLE"
class="uri">https://www.youtube.com/watch?v=kcpiH6dDWLE</a></p></li>
<li><p>To read more about how OSM stores fire-station data, see here -
<a
href="https://wiki.openstreetmap.org/wiki/Emergency_facilities_and_amenities"
class="uri">https://wiki.openstreetmap.org/wiki/Emergency_facilities_and_amenities</a></p></li>
</ul>
<br><br>
</details>
<div class="small-gap">

</div>
</div>
<div id="step-d3---extract-polygons-map" class="section level5">
<h5>Step D3 - Extract polygons &amp; map</h5>
<details>
<summary>
<strong>Expand and complete!</strong>
</summary>
<p><br></p>
<ul>
<li>The point data is often messy (people adding fire-hoses etc). So we
are going to focus on the polygon fire station buildings.</li>
<li>Add this command into your lab script and run. This will turn
fire-stations into the type of spatial file you are used to.</li>
</ul>
<pre class="r"><code>fire_station_buildings &lt;- fire_stationdata$osm_polygons</code></pre>
<ul>
<li>Now, Make a map of the fire stations in Chicago, remembering if you
are using tmap that you are using tm_polygons() NOT tm_dots().</li>
</ul>
<br><br>
</details>
<div class="small-gap">

</div>
</div>
<div id="step-d4---find-centroids-map" class="section level5">
<h5>Step D4 - Find centroids &amp; map</h5>
<details>
<summary>
<strong>Expand and complete!</strong>
</summary>
<p><br></p>
<ul>
<li><p>It’s clear our polygons are VERY small compared to the overall
area. And in terms of the topic, I don’t really care how big the fire
station buildings are, just that they exist. So let’s choose the MEAN
CENTRE and convert it into points.<br />
<br />
As we discussed in class, there are a few ways to do this. Given that we
don’t really care about the shape of our buildings, lets use
st_centroid, which will find the “centre of mass” of each building.</p>
<p><br />
<br />
<img src="index_images/pg_lab4_MeanCentre.png" /></p></li>
<li><p>Add this command into your lab script and run. This will convert
the fire station data into points. It might give you a warning about
geometries, ignore it!</p></li>
</ul>
<pre class="r"><code>fire_stations &lt;- st_centroid(fire_station_buildings)</code></pre>
<p><br><br></p>
<ul>
<li>In your report, Make a map of the fire station locations (points
e.g. tm_dots) - it will be easier to make out a pattern. Describe the
features of the pattern you see and what you think might be causing
it.</li>
</ul>
<p>You should see something like this:</p>
<img src="index_images/pg_lab4_firestations.png" style="width:90.0%" />
<br><br>
</details>
<p><br><br></p>
</div>
</div>
<div id="exercise.-closest-stations" class="section level4">
<h4>Exercise. Closest stations</h4>
<p>Now we have the fire station locations, we want to consider
“neighbourhood”. Which fire-stations are <em>closest</em> to one another
and what does “closest” even mean?</p>
<p>This is a genuine issue faced by emergency authorities. For example,
it is needed when considering which stations deserve new vehicles, or
where to put new stations.</p>
<p>Have a look at this report, which explores the issue for Columbus
Ohio - and which gets to use several billion pieces of data.. <a
href="https://storymaps.arcgis.com/stories/0037b3eb93904ed6aa00cbba424af0da"
class="uri">https://storymaps.arcgis.com/stories/0037b3eb93904ed6aa00cbba424af0da</a>.
It was completed by one of our MGIS alumni, Rob Ford.</p>
<p><br></p>
<div id="step-d5---measuing-distance" class="section level5">
<h5>Step D5 - Measuing distance</h5>
<details>
<summary>
<strong>Expand for instructions</strong>
</summary>
<p><br></p>
<p>In your report, come up with AT LEAST three different ways that you
could measure the ‘closeness’ or ‘distance’ between fire-stations. Use
the reading above to justify your answers. We will also talk about this
in class.</p>
<p><br><br></p>
</details>
<p><br><br><br></p>
</div>
</div>
</div>
</div>
<div id="week-2" class="section level2">
<h2>WEEK 2</h2>
<p class="comment"><strong>DOMAIN:</strong><br> I AM NOW LETTING YOU SORT OUT YOUR OWN STRUCTURE/HEADINGS/SUB-HEADINGS ETC.  Please make it easy to grade and to find your answers (20% of your grade is on style..).  For example, write in full sentences, make sure all the plots etc make sense and that your code is neat, using headings/sub-headings/bullets etc.  </p>
<div class="small-gap">

</div>
<p><br></p>
<p>Re-open your project, re-open your .RmD lab report and run all the
code chunks. Your report &amp; R-Studio should look something like the
screenshot below (it might not be <em>identical</em> but it should be
similar).</p>
<p><img src="index_images/pg_lab4_week2.png" style="width:100.0%" /></p>
<p><br><br></p>
<div id="e.-removing-variables" class="section level3">
<h3>E. Removing variables</h3>
<p>Especially for people using POSIT-Cloud, it’s good practice to remove
large datasets and variables that you’re not planning to use. In our
case, we are ONLY planning to use the fire_station point locations, so
we can remove the other data using the <code>rm()</code> command</p>
<details>
<summary>
<strong>Expand for instructions</strong>
</summary>
<p><br></p>
<p>This is by no means essential, but it gives your computer a
<em>tiny</em> bit more energy to run code, alongside keeping everything
neat.</p>
<p>This command will remove your Chicago bounding box and your large
fire_stationdata variables.</p>
<pre class="r"><code>rm(bbox_city_rectangle)
rm(fire_stationdata)</code></pre>
<ul>
<li>Go to the end of your lab report. <br><br></li>
<li>Make a new section heading called Week 2. <br><br></li>
<li>Inside, make a new code chunk and copy the code above into it. Add a
third line to remove the fire_station_buildings variable.<br><br></li>
<li>Run the code chunk. You should see the variables disappear in the
environment tab. Nothing else should happen.</li>
</ul>
<br><br>
</details>
<p><br><br></p>
</div>
<div id="f.-subsetting-to-the-south-east-side" class="section level3">
<h3>F. Subsetting to the South-East Side</h3>
<p><br></p>
<table>
<colgroup>
<col width="37%" />
<col width="62%" />
</colgroup>
<tbody>
<tr class="odd">
<td><br><br> <em>Chicago has a set internal neighbourhoods, arranged
informally into “sides” e.g. “Northside”, “SouthSide”… These
neighbourhood are not federally recognized, but they are used by the
city and by local people. So.. we can access this data via downloading
it from Chicago’s City Data Portal.</em> <br><br>Let’s subset to a
smaller dataset, because I know that the people on POSIT-Cloud have been
struggling. Specifically, we are going to focus on South East
Chicago.</td>
<td><a
href="https://commons.wikimedia.org/wiki/File:Chicago_community_areas_map.svg"><img
src="index_images/pg_lab4_ChicagoSides.png" width="800"
alt="Chicago’s neighbourhoods" /></a></td>
</tr>
</tbody>
</table>
<p><br></p>
<div id="step-f1.-get-the-boundary-data-read-into-r"
class="section level4">
<h4>Step F1. Get the boundary data &amp; read into R</h4>
<details>
<summary>
<strong>Expand for instructions</strong>
</summary>
<p><br><br></p>
<ul>
<li><p>Go to this website. <a
href="https://data.cityofchicago.org/Facilities-Geographic-Boundaries/Boundaries-Community-Areas-current-/cauq-8yn6"
class="uri">https://data.cityofchicago.org/Facilities-Geographic-Boundaries/Boundaries-Community-Areas-current-/cauq-8yn6</a></p></li>
<li><p>On the top right, click Export, then choose the GeoJSON format.
Move/upload the file into your project folder.</p></li>
</ul>
<p><img src="index_images/pg_lab4_ChicagoData.png"
style="width:80.0%" /></p>
<p><br><br></p>
<ul>
<li>In your lab report, read the data into R using the
<code>st_read()</code> command - e.g. copy/paste the code-chunk
below:</li>
</ul>
<pre class="r"><code>CommunityAreas &lt;- st_read(&quot;Boundaries - Community Areas (current).geojson&quot;)
CommunityAreas

# make a quick map
qtm(CommunityAreas)</code></pre>
<ul>
<li>Your map should look like Chicago boundaries.</li>
</ul>
<br><br>
</details>
<div class="small-gap">

</div>
</div>
<div id="step-f2.-select-our-area-of-interest." class="section level4">
<h4>Step F2. Select our area of interest.</h4>
<details>
<summary>
<strong>Expand for instructions</strong>
</summary>
<p><br></p>
<ul>
<li><p>We are going to focus on the following community areas in the far
South East of the city:</p>
<ul>
<li>“ROSELAND”</li>
<li>“PULLMAN”</li>
<li>“SOUTH DEERING”</li>
<li>“EAST SIDE”</li>
<li>“WEST PULLMAN”</li>
<li>“RIVERDALE”</li>
<li>“HEGEWISCH”</li>
</ul></li>
</ul>
<p><br></p>
<ul>
<li>In your lab report, make a new code chunk and copy this code across
to filter to these communities. If you get a weird error, try re-typing
the quote marks.</li>
</ul>
<pre class="r"><code>CommunityAreas_SE &lt;- CommunityAreas  %&gt;%
   filter(community %in% c(&quot;ROSELAND&quot;,
                           &quot;PULLMAN&quot;,
                           &quot;SOUTH DEERING&quot;,
                           &quot;EAST SIDE&quot;,
                           &quot;WEST PULLMAN&quot;,
                           &quot;RIVERDALE&quot;,
                           &quot;HEGEWISCH&quot;))

# make a quick map
qtm(CommunityAreas_SE)</code></pre>
<br><br>
</details>
<div class="small-gap">

</div>
</div>
<div id="step-f3.-subset-the-fire-stations-to-this-area."
class="section level4">
<h4>Step F3. Subset the fire-stations to this area.</h4>
<details>
<summary>
<strong>Expand for instructions</strong>
</summary>
<p><br></p>
<ul>
<li><p>Finally, we’re going to use the <code>st_intersection()</code>
command to select only the fire stations within our chosen
communities.</p></li>
<li><p>In your lab report, make a new code chunk and copy/run this code
to filter to these communities.</p></li>
</ul>
<pre class="r"><code># Subset the firestations
 fire_station_local &lt;- st_intersection(fire_stations, 
                                       CommunityAreas_SE)


# Make a quick plot
 tm_shape(CommunityAreas_SE) +
   tm_borders() +
   tm_shape(fire_station_local) +
   tm_dots(col = &quot;red&quot;, size = 0.5)+
   tmap_mode(&quot;view&quot;)</code></pre>
<br><br>
</details>
<div class="small-gap">

</div>
</div>
<div id="step-f4.-questions" class="section level4">
<h4>Step F4. Questions</h4>
<details>
<summary>
<strong>Expand for instructions</strong>
</summary>
<p><br></p>
<p>I want to check your understanding of what we have just done. So
after the code, please answer the following questions in your lab
report. Remember you can look at the data by clicking its name in the
environment tab, or by using summary(), head(), table() etc.</p>
<ol style="list-style-type: decimal">
<li>How many fire stations are inside CommunityAreas_SE? <br><br></li>
<li>How many unique zip-codes/post-codes are there in the
fire_station_local data? <br> <em>(hint, table command. <br>hint2. there
is a useful column inside fire_station_local called addr.postcode)</em>
<br><br></li>
<li>Are there any fire-stations in Riverdale? If so, how many? <br>
<em>(hint, look at the community column in fire_station_local
data…)</em></li>
</ol>
<br><br>
</details>
<p><br><br></p>
</div>
</div>
<div id="g.-measuring-distance-in-r" class="section level3">
<h3>G. Measuring distance in R</h3>
<p>As discussed in class, there are several ways we can measure distance
using R-Studio. Here, we are going to explore cartesian distance
(e.g. “as the crow flies” or straight line distance) and driving
distance using Open Street map.</p>
<p><br></p>
<div id="step-g1.-calculating-distance-code" class="section level4">
<h4>Step G1. Calculating distance code</h4>
<details>
<summary>
<strong>Expand for instructions</strong>
</summary>
<p><br></p>
<p>The code below will calculate the straight-line and driving distance
between two locations in our dataset.</p>
<ul>
<li><p>We can calculate the straight-line distance between two objects
using the st_distance() command. This defaults to calculating distances
in metres, so I often change it to km.</p></li>
<li><p>We can calculate driving distances (and routes) between two
objects using the osrmRoute() command. You can also choose walking or
cycling.</p></li>
</ul>
<p><br></p>
<p><strong>YOU NEED A NEW PACKAGE! <br> GO TO THE PACKAGES TAB
INSTALL/DOWNLOAD THE <code>osrm</code> package. <br>THEN SCROLL UP TO
YOUR LIBRARY CODE CHUNK IN YOUR REPORT. ADD <code>library(osrm)</code>
AND RUN THE CODE CHUNK. THEN SCROLL BACK DOWN TO THE END OF YOUR
REPORT</strong></p>
<ul>
<li>Copy these code chunks into your report, understand what they are
doing and run them. You should see that the cartesian distance is
~2.19km and the driving distance ~3.04km, alongside a map.</li>
</ul>
<pre class="r"><code># Choose which locations you want to look at the distance between
# In our case, we are choosing objects/rows from our firestation data.
# They could be row numbers you type manually or some sort of filter
# I am showing you both examples
 
location1 &lt;- fire_station_local[1,]
location2 &lt;- dplyr::filter(fire_station_local,osm_id == &quot;210429692&quot;)</code></pre>
<p><br></p>
<pre class="r"><code># Calculate the straight line distance
Distance_Cartesian_m  &lt;- st_distance(location1,location2)
Distance_Cartesian_km &lt;- as.numeric(Distance_Cartesian_m/1000)
Distance_Cartesian_km</code></pre>
<p><br></p>
<pre class="r"><code># And driving distance 
Distance_Driving &lt;- osrmRoute(src = location1,dst = location2,
                              overview = &quot;full&quot;,osrm.profile=&quot;car&quot;)
Distance_Driving</code></pre>
<p><br></p>
<pre class="r"><code># And driving distance 
Distance_Driving &lt;- osrmRoute(src = location1,dst = location2,
                              overview = &quot;full&quot;,osrm.profile=&quot;car&quot;)
Distance_Driving</code></pre>
<p><br></p>
<pre class="r"><code># To plot the straight line distance we need to manually
# create a straight line between our locations
line_between &lt;- st_cast(st_union(location1, location2), &quot;LINESTRING&quot;)

# Step 4: Plot both lines and annotate them
tm_shape(line_between) +
   tm_lines(col = &quot;red&quot;, lwd = 2, title.col = &quot;Euclidean Line&quot;) +
   tm_shape(Distance_Driving) +
   tm_lines(col = &quot;blue&quot;, lwd = 2, title.col = &quot;Driving Line&quot;) +
   tm_shape(fire_station_local) +
   tm_dots() + tm_legend()+
   tmap_mode(&quot;view&quot;)</code></pre>
<br><br>
</details>
<p><br></p>
</div>
<div id="step-g2.-challenge" class="section level4">
<h4>Step G2. Challenge</h4>
<details>
<summary>
<strong>Expand for instructions</strong>
</summary>
<p><br></p>
<ul>
<li><p>Choose two fire-stations that are “close” in terms of
straight-line distance, but “far apart” in terms of driving
distance.</p></li>
<li><p>Hint, try running
<code>qtm(fire_station_local) + tm_text("osm_id")</code> to help you
work out which station is which.</p></li>
<li><p>In your report, edit the code (above) that you just ran to
calculate the distance between your chosen stations. Run the code and
make a map of the two distances. <br> <em>Hint You ONLY need to edit the
row numbers in the first code chunk then run</em></p></li>
<li><p>Justify why you chose those two stations in your lab report. (You
don’t have to be right, you just have to have some reasoning why you
chose those two points).</p></li>
</ul>
<br><br>
</details>
<p><br><br></p>
</div>
</div>
<div id="h.-spatial-weights-matrix---points" class="section level3">
<h3>H. Spatial weights matrix - POINTS</h3>
<p>As discussed in class this week, a spatial matrix is a way of
recording the distances between objects - and we can use them to make a
spatial weights matrix defining the neighbourhood.</p>
<p><br></p>
<div id="step-h1.-distance-matrices" class="section level4">
<h4>Step H1. Distance matrices</h4>
<details>
<summary>
<strong>Expand for instructions</strong>
</summary>
<p><br></p>
<p>Cartesian distance matrices</p>
<ul>
<li><p>These are VERY easy. This is all the code you need.
<br><br></p></li>
<li><p>Copy/run this code chunk, <br><br></p></li>
</ul>
<pre class="r"><code># you just run the st_distance command with a table of 
# data rather than two points. I divided by 1000 to put it in km.
Distmatrix_cartesian &lt;- round(st_distance(fire_station_local)/1000,3)
Distmatrix_cartesian</code></pre>
<p><br><br></p>
<p>Driving distance matrices</p>
<ul>
<li><p>Driving distance matrices are much harder and rely on Dr G’s
custom code. If you want to see how to scale this up, come to an office
hr with Dr G. <br><br></p></li>
<li><p>Copy/run this code chunk <br><br></p></li>
</ul>
<pre class="r"><code>#---------------------------------------------------------
# Calculate the DRIVING distance between each pair of fire stations
# Copy/paste this code chunk EXACTLY
#---------------------------------------------------------
# Extract coordinates
fire_station_coords &lt;- st_coordinates(st_geometry(fire_station_local))

# Create a matrix to store driving distances
num_stations     &lt;- nrow(fire_station_coords)
Distmatrix_drive &lt;- matrix(NA, nrow = num_stations, ncol = num_stations)

# Generate unique station pairs for the upper triangle
pairs &lt;- expand.grid(1:num_stations, 1:num_stations)
pairs &lt;- pairs[pairs$Var1 &lt; pairs$Var2, ]

for(n in 1:nrow(pairs)){
   drivedist &lt;- osrmRoute(src = fire_station_coords[pairs[n,1], ],
                      dst = fire_station_coords[pairs[n,2], ],
                      overview = FALSE,osrm.profile=&quot;car&quot;)[2]

   Distmatrix_drive[pairs[n,1], pairs[n,2]] &lt;- as.numeric(drivedist)
   Distmatrix_drive[pairs[n,2], pairs[n,1]] &lt;- as.numeric(drivedist)
}

Distmatrix_drive</code></pre>
<p>CHALLENGE</p>
<p>Look up your two points in the two matrices and confirm that they
match your first calculation and what you expect from Lecture 8A.
Visusalising these matrices is hard because they have units assigned (Dr
G is working on it). So you don’t need to do anything here if the code
is running.</p>
<br><br>
</details>
<p><br><br></p>
</div>
</div>
<div id="i.-neighbourhood" class="section level3">
<h3>I. Neighbourhood</h3>
<p><br></p>
<p>Now we have “distance” we can decide which fire-stations are
“neighbours” of each other. This will lead to a “spatial weights matrix”
where 1 = DEFINITELY a neighbour and 0 = DEFINITELY not a neighbour.
Sometimes we can choose to have a sliding scale between the two.</p>
<p><strong>NOTE: No-one has written a package (yet!) that calculates the
neighbourhood for driving distances, so we are going to focus on the
cartesian distances for the rest of the lab</strong></p>
<p><br></p>
<div id="step-i1.-nearest-neighbours" class="section level5">
<h5>Step I1. Nearest Neighbours</h5>
<details>
<summary>
<strong>Expand for instructions</strong>
</summary>
<p><br></p>
<p>The <code>st_knn()</code> command will automatically work out the
nearest neighbours for straight-line distances. Copy/run the code below.
To change the number of nearest neighbours, just change k and
re-run.</p>
<pre class="r"><code># Closest neighbour 
knn_cartesian &lt;- st_knn(st_geometry(fire_station_local), k = 1)
knn_cartesian

# It&#39;s old fashioned in that it can only be plotted in a certain way, 
# Just copy/paste this.
# Spatial weights are a special type of data that tmap hates.
# 
# Get coordinates 
fire_station_coords &lt;- st_coordinates(fire_station_local)
# And plot.
plot(st_geometry(fire_stations),
     col = &quot;blue&quot;, pch = 16,cex=.6,
     main = &quot;Fire Stations and Their Neighbors&quot;)
plot(knn_cartesian, coords = fire_station_coords, col = &quot;red&quot;)
plot(st_geometry(CommunityAreas_SE),add=TRUE)</code></pre>
<ul>
<li>CHALLENGE. In your lab report, change k from 1,2,3,4,5… and re-run
the code. Describe what you see and explain what is happening in your
lab report.</li>
</ul>
<br><br>
</details>
<div class="small-gap">

</div>
</div>
<div id="step-i2.-distance-bands" class="section level5">
<h5>Step I2. Distance bands</h5>
<details>
<summary>
<strong>Expand for instructions</strong>
</summary>
<p><br></p>
<p>The <code>dnearneigh()</code> command will automatically work out the
nearest neighbours for straight-line distances. Copy/run the code below.
To change the number of nearest neighbours, just change k and
re-run.</p>
<pre class="r"><code># This suggests a &quot;neighbour&quot; is any object less than 3000m away.
dnn &lt;- dnearneigh(coords, d1 = 0, d2 = 3000)

# Assuming distance band
coords &lt;- st_coordinates(fire_station_local)
plot(st_geometry(fire_stations),
     col = &quot;blue&quot;, pch = 19,
     main = &quot;Fire Stations and Their Neighbors&quot;)
plot(dnn, coords, add=TRUE, col = &quot;red&quot;)
print(dnn)</code></pre>
<ul>
<li>CHALLENGE. In your lab report, change d2 from 3000 to 1000, 2000,
4000… and re-run the code. Describe what is happening and explain what
is happening in your lab report.</li>
</ul>
<br><br>
</details>
<div class="small-gap">

</div>
<p><br></p>
</div>
<div id="step-i3.-summary." class="section level5">
<h5>Step I3. Summary.</h5>
<p>Imagine you are working with Chicago authorities to work out how
fire-stations should share resources and territory. Which type/order of
spatial weights matrix would you choose and why? Explain your answer in
your lab report.</p>
<p><br><br></p>
</div>
</div>
<div id="j.-spatial-weights-matrix---polygons" class="section level3">
<h3>J. Spatial weights matrix - POLYGONS</h3>
<p>Finally, I want you to see the code for assessing the spatial weights
matrices of polygons.</p>
<ul>
<li>Here are two examples that should run. Copy/run the code in your
report</li>
</ul>
<pre class="r"><code>coords &lt;- st_coordinates(st_centroid(CommunityAreas_SE))

rook_neighbors &lt;- st_contiguity(CommunityAreas_SE, queen=FALSE)
queen_neighbors &lt;- st_contiguity(CommunityAreas_SE, queen=TRUE)


# and plot - they might come out small. not sure why
plot(st_geometry(CommunityAreas_SE))
plot(rook_neighbors, coords, add=TRUE, col = &quot;red&quot;, main=&quot;Rook&#39;s 1st order&quot;)


plot(st_geometry(CommunityAreas_SE))
plot(queen_neighbors, coords, add=TRUE, col = &quot;blue&quot;,main=&quot;Queen&#39;s 1st order&quot;)</code></pre>
<ul>
<li>In your report, please explain what each one is doing and how they
define “neighbour”. Hint, see Lecture 8A…</li>
</ul>
<p><br><br></p>
</div>
<div id="k.-tidy-your-report" class="section level3">
<h3>K. TIDY YOUR REPORT!</h3>
<p>A lot of this week’s lab was showcasing some of the commands that
we’ve spoken about in the lectures. So go back and make your report
neat, with headings and subheadings so its easy to find the answers,
answers are written up in full sentences, you’ve removed any unneeded
code or text.</p>
<p><br><br></p>
</div>
<div id="where-were-going" class="section level3">
<h3>WHERE WE’RE GOING</h3>
<p>Because of the big shifts with the R spatial code, it’s proving
tricky to make sure your lab actually works. So if you finish this
quickly, here is the direction next week is going…</p>
<ul>
<li><a
href="https://mgimond.github.io/Spatial/spatial-autocorrelation.html"
class="uri">https://mgimond.github.io/Spatial/spatial-autocorrelation.html</a></li>
<li><a
href="https://mgimond.github.io/Spatial/spatial-autocorrelation-in-r.html"
class="uri">https://mgimond.github.io/Spatial/spatial-autocorrelation-in-r.html</a></li>
</ul>
<p>Reading these examples now will make week 2 MUCH easier.</p>
<p><br><br></p>
</div>
</div>
<div id="submitting-your-lab" class="section level2">
<h2>SUBMITTING YOUR LAB</h2>
<p>Remember to save your work throughout and to spell check your writing
(next to the save button). Now, press the knit button again. If you have
not made any mistakes in the code then R should create a html file in
your lab2 folder, complete with a very recent time-stamp.</p>
<p><br></p>
<div id="if-you-use-the-posit-cloud-website" class="section level3">
<h3>If you use the POSIT cloud website</h3>
<p>You can download each of your .RmD and html files by:</p>
<ul>
<li>Clicking on the little box next to the Rmd in the Files tab, then
going to the little blue cogwheel (might need to make your Rstudio full
screen) and clicking export.<br></li>
</ul>
<p><img src="index_images/im_T2_Download.png" width="90%" style="display: block; margin: auto;" /></p>
<ul>
<li><p>Repeat the process exactly for the html file underneath it (e,g,
just have the html clicked.)<br></p></li>
<li><p>Now go to Canvas and submit BOTH your html and your .Rmd file in
Lab 3</p></li>
</ul>
<p><br></p>
</div>
<div id="if-you-use-the-rstudio-desktop-on-your-own-computer"
class="section level3">
<h3>If you use the RSTudio desktop on your own computer</h3>
<ul>
<li><p>Press knit!</p></li>
<li><p>Go to your Lab 4 folder, In that folder, double click on the html
file. This will open it in your browser. CHECK THAT THIS IS WHAT YOU
WANT TO SUBMIT <br></p></li>
<li><p>Now go to Canvas and submit BOTH your html and your .Rmd file in
Lab 4.<br></p></li>
</ul>
<p><img src="index_images/pg_364Lab1_Basics_2021_fig1.png" width="1673" /></p>
<p><br></p>
</div>
</div>
<div id="grading-check-list" class="section level2">
<h2>GRADING CHECK-LIST</h2>
<p>[110 marks total]</p>
<div id="what-does-your-grade-mean" class="section level3">
<h3>What does your grade mean?</h3>
<p>Overall, here is what your lab should correspond to:</p>
<table class=" lightable-classic-2 table table-striped table-hover table-responsive" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Grade
</th>
<th style="text-align:left;">
% Mark
</th>
<th style="text-align:left;">
Rubric
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A*
</td>
<td style="text-align:left;">
98-100
</td>
<td style="text-align:left;">
Exceptional.  Not only was it near perfect, but the graders learned
something.  THIS IS HARD TO GET.
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
96+
</td>
<td style="text-align:left;">
You went above and beyond
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
93+:
</td>
<td style="text-align:left;">
Everything asked for with high quality.   Class example
</td>
</tr>
<tr>
<td style="text-align:left;">
A-
</td>
<td style="text-align:left;">
90+
</td>
<td style="text-align:left;">
The odd minor mistake, All code done but not written up in full
sentences etc. A little less care
</td>
</tr>
<tr>
<td style="text-align:left;">
B+
</td>
<td style="text-align:left;">
87+
</td>
<td style="text-align:left;">
More minor mistakes.  Things like missing units, getting the odd
question wrong, no workings shown
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
83+
</td>
<td style="text-align:left;">
Solid work but the odd larger mistake or missing answer.  Completely
misinterpreted something, that type of thing
</td>
</tr>
<tr>
<td style="text-align:left;">
B-
</td>
<td style="text-align:left;">
80+
</td>
<td style="text-align:left;">
Starting to miss entire/questions sections, or multiple larger mistakes.
Still a solid attempt. 
</td>
</tr>
<tr>
<td style="text-align:left;">
C+
</td>
<td style="text-align:left;">
77+
</td>
<td style="text-align:left;">
You made a good effort and did some things well, but there were a lot of
problems. (e.g. you wrote up the text well, but messed up the code)
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
70+
</td>
<td style="text-align:left;">
It’s clear you tried and learned something.  Just attending labs will
get you this much as we can help you get to this stage
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:left;">
60+
</td>
<td style="text-align:left;">
You attempt the lab and submit something. Not clear you put in much
effort or you had real issues
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
0+
</td>
<td style="text-align:left;">
Didn’t submit, or incredibly limited attempt. 
</td>
</tr>
</tbody>
</table>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>


</body>
</html>

---
title: "Lab 3: Spatial Basics"
subtitle: <h4 style="font-style:normal">GEOG-364 - Spatial Analysis</h4>
output: 
  html_document: 
    toc: true
    toc_depth: 4
    toc_float: true
    theme: flatly
    section_numbering: false
editor_options: 
  chunk_output_type: console
---



```{r, include=FALSE, echo=FALSE,results='hide',warning=FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message = FALSE)

# THE FORMAT YOU LIKE IS LAB 3 INSIDE 2022

# invisible data read
library(tidyverse)
library(sp)
library(sf)
library(readxl)
library(skimr)
library(ggplot2)
library(tmap)
library(viridis)
library(kableExtra)
library(plotly)
library(readxl)
library(osmdata)



```

<br>

## Welcome to Lab 3!

The aim of this lab is to start looking at tables of data and to make your first maps.

By the end of this week's lab, you will be able to:

-   

    1.  Make a markdown template

-   

    2.  Read in data from an excel file

-   

    3.  Conduct exploratory data analysis

-   

    4.  Wrangle a table of data

-   

    5.  Make initial plots and maps

The lab is worth 110 points and there is a rubric at the end of this page.

```{=html}
<p class="comment"><strong>THIS IS A TWO WEEK LAB. You have two full lab sessions, then, assignment 3 is due the week afterwards.</strong></p>
```
<br><br>

## WEEK 1

### A: Set up - DON'T SKIP

<br>

#### Step A1. Files & Projects

<details>
<summary>POSIT CLOUD people, expand for set up</summary>
<br>

**Step i:**<br>Go to <https://posit.cloud/content/> and make a new project for Lab 3 <br><br>

**Step ii:**<br>Run this code IN THE CONSOLE to install the packages you need. <br>

 -  This is going to take 5-10 minutes, so let it run and carry on. <br><br>
 

```{r, eval=FALSE}

install.packages("readxl")
install.packages("tidyverse")
install.packages("ggplot2")
install.packages("dplyr")

install.packages("remotes")

remotes::install_github(repo = "r-spatial/sf", 
                        ref = "93a25fd8e2f5c6af7c080f92141cb2b765a04a84")

install.packages("terra")
install.packages("tmap")
install.packages("elevatr")
install.packages("nasapower")
install.packages("osmdata")
install.packages("tigris")
install.packages("rmdformats")
install.packages("plotly")
install.packages("ggstatsplot")



# If you get a weird error it might be that the quote marks have messed up. 
# Replace all of them and ask Dr G for a shortcut.

```
<br><br>

**Step iii:   **<br>Go to the Lab Canvas page and download these 3 files.  Upload each one into your project folder.<br>*Forgotten how? See Lab 2 Set-Up.* <br>

   1. Your PERSONAL UFO dataset (look for the csv file with your email ID). <br>
   2. Your PERSONAL Spatial State-level dataset. <br>
   3. The lab report template .RmD file.<br>
   
     
<br>
</details>
 
<br>
<details>
<summary>R-DESKTOP people, expand for set up</summary>

<br>

**Step i:**<br>Create a new project for Lab 3.<br>*Forgotten how? See Lab 2 Set-Up.*<br><br>

**Step ii:**<br>Go to the Lab Canvas page and download these 3 files.<br> Put each one in your Lab 3 project folder. <br>

   1. Your PERSONAL UFO dataset (look for the csv file with your email ID). <br>
   2. Your PERSONAL Spatial State-level dataset. <br>
   3. The lab report template .RmD file.<br><br>
   
**Step iii:**<br>Open the Lab report template and try to knit. Install any packages you are missing (either via clicking the little yellow bar or by clicking Packages/Install)  <br><br>

</details>
<br><br>

#### Step A2. Change the theme


<details>
<summary>Instructions</summary>
<br>

This is more for us when we're grading!  It helps us to not go insane when we're reading 60 reports.<br><br>

**Step i:**  Change the AUTHOR line to your personal E-mail ID <br><br>
 
**Step ii:**  Go here and choose a theme out of downcute, robobook, material, readthedown or html_clean: <https://github.com/juba/rmdformats?tab=readme-ov-file#formats-gallery>.<br> *DO NOT CHOOSE html_docco - it doesn't have a table of contents*  <br><br>
 
**Step iii:**<br>Change the theme line on the template YAML code to a theme of your choice. See the example YAML code below <br>
*Note, downcute chaos is different - see below*<br><br>

 1. Example YAML code if you want `robobook`, `material`, `readthedown` or `html_clean`. You can also change the highlight option to change how code chunks look. - see the rmdformats website.

```{r,eval=FALSE}

---
title: "Lab 3"
author: "ADD YOUR EMAIL ID"
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
    self_contained: true
    highlight: kate
---

```

<br>

 2. Example YAML code if you want `downcute` or `downcute chaos`. For white standard downcute, remove the downcute_theme line.

```{r,eval=FALSE}

---
title: "Lab 3"
author: "ADD YOUR EMAIL ID"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    downcute_theme: "chaos"
    default_style: "dark"
---
      
```

<br><br>
</details>
<br><br>

#### Step A3. DO NOT KNIT

There is code missing in your reports for you to complete and it will not work.


<br><br>

### B: UFO Analysis - Week 1

You have each been given some (genuine) about UFOs for a specific US State.  Because you all have unique data, you will all get different results and so you can work together.

<br>

#### Step B2. Learn about the datasets


<details>
<summary>Instructions</summary>
<br>


**Step i:** 
First, learn about the UFO data (you will write about it in Step 3). Look at these websites and BRIEFLY note down to yourself,, how was the data collected? Why? e.g. what were the people who collected the data trying to achieve?  Also note down any other relevant information you can see. E.g. is data stored as points or polygons etc.  <br>

 - The raw data was collected from here: <https://nuforc.org/>  <br>
 
  - The actual data was obtained from here <https://github.com/planetsig/ufo-reports>  <br>
 

<br>
**Step ii:** 
You are also going to be using some data from the US government American Community Survey (you will write about it in Step 3). Look at these resources and BRIEFLY note down to yourself, how was the data collected? Why? e.g. what were the people who collected the data trying to achieve?  Also note down any other relevant information you can see. E.g. is data stored as points or polygons etc.  <br>

 - You can read about it here: <https://www.socialexplorer.com/help/faq/knowledge-base/american-community-survey-basics>  <br>
 
  - Or there are a LOAD of youtube videos and resources out there  <br>
 

<br><br>
</details>
<br><br>


### SUBMITTING WEEK 1

You don't _need_ to submit anything this week.

HOWEVER, I will give two bonus points (within the lab) to anyone who submits their completed .Rmd and .html up until this point in your Lab 3 canvas assignment. 

 - You are getting the bonus point for not leaving it all until the last minute.  I don't currently have the capacity to provide individual feedback unless you ask questions as a submission comment.  You will resubmit with the full report next week


----------------------------------------------------------------------


## WEEK 2: 

<br>

### C. DON'T SKIP (Important!)

<br>

#### C1. Week 2 Introduction

Welcome to the second part of Lab 3. You are going to be looking at the data in more detail, and learn these new skills:

-   Loading these datasets for your UFO data.

    - Elevation data from the `elevatr` package

    - US border and road data from the `tigris` package

    - US military locations from the `osmdata` package, which is linked to Open Street Map.

-   Extracting raster data and polygon data at point locations

-   Summarising point data across polygons

-   Making professional maps

-   Conducting and interpreting hypothesis tests

-   Considering the process & pattern in your UFO data.

Note, By this point you have hopefully realised that your object of analysis is NOT an actual UFO! <br> Instead it's *a reported sighting* of a UFO to NUFORC by an interested person. So bear in mind that this dataset might say more about the spatial patterns of "internet savvy people who are interested in UFOs" than anything else.

<br><br>

#### C2. Getting started

By this point, you must have completed everything in Week 1. Then

1.  Re-Open your project file for Lab 3.
2.  Open your .RmD Lab 3 report from Week 1.
3.  Press knit to make sure it works and looks good. Correct any errors/typos that you see.
4.  If it doesn't knit at this point or you have qustions, ASK FOR HELP IN LAB.

Now, there are few things you MUST tweak in order to make lab 2 work:

#### C3 IMPORTANT Correct my typo!

<details>
<summary>Instructions</summary>
<br>

Some of you who had an early version of the lab 3 template might need to correct a typo in single code chunk.

-   Scroll up to near the top of your report abd look in the "Make Spatial" section. You should see a code chunk about making the ufo_sf variable.

-   In an early version I accidentally left in an old command which sets up your data with the wrong map projection.

**If your Make Spatial code chunk looks DIFFERENT to this, replace the code-chunk with this code.**

```{r, eval=FALSE}
ufo_sf <- st_as_sf(ufo, coords = c("Longitude", "Latitude"), crs = 4326)

# Transform the map projection
albers <- 5070
ufo_sf <-st_transform(ufo_sf,crs=albers)
acs_sf <-st_transform(acs_sf,crs=albers)

```

</details>
<br>

#### C4 IMPORTANT Add packages

<details>
<summary>Instructions</summary>
<br>



Scroll up to your library code chunk at the top. Add these two packages to the end and save/knit your report. Then try to run the library code chunk and if needed, download/install the packages from the internet.

```{r}
library("raster")
library("rstantools")
library("exactextractr")
```

</details>
<br>

#### C5 IMPORTANT Week 2 lab template

<details>
<summary>Instructions</summary>
<br>

Finally, I have provided a template for your work in week 2.

1.  Go to Canvas and the Lab 3 website.
2.  Download the **WEEK2_Template.RmD** and put it in your Project 3 folder.
3.  In R-Studio, open WEEK2_Template.RmD, highlight everything (CmD-A if you want a keyboard shortcut) and press copy.
4.  Go to your main Lab 3 report, scroll to the end and press paste.
5.  Knit to check it all works.


</details>
<br><br>

### D. UFO Analysis Continued

<br>

You will again continue to follow through your lab reports.  I will be putting tutorials here to help you. 

<br>


#### D1. TIGRIS Tutorial

<details>
<summary>What is TIGRIS?</summary>
<br>

What is TIGRIS?

<iframe width="560" height="315" src="https://www.youtube.com/embed/GqC1HjAKui4?start=908"
        frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen></iframe>

</details>
<br>





#### D2. Making maps Tutorial

<details>
<summary>Instructions to be added</summary>
<br>




</details>
<br>


#### D3. More to come

<details>
<summary>Instructions</summary>
<br>


</details>
<br>


























